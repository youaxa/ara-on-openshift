# ara-on-openshift

Based on source code available at: https://github.com/Decathlon/ara

- custom layered build of ARA based on centos7 containers using: openjdk-1.8.0(required), maven-3.6.0(required >=3.1.0)
- custom deployment for MySQL-5.5, based on image available at https://quay.io/repository/dagniel/sclorg-mysql-container

The entire configuration stack relies on custom Images being available from Image Streams.
Most of the top level configurations can be parametrized in the Openshift templates supplied.

## Usage:
### 1. from WebConsole
From Openshift's WebConsole, the templates can be created inside the namespace/Project via 
"Add to Project" -> "Import YAML/JSON"
- import `templates/mysql/myql-ConfMap.yaml`; this will create the `mysql-conf` ConfMap object in the namespace
- import `templates/mysql-ephemeral.yaml`; this will create the template for the custom deployment for MySQL-5.5 
which uses ARA's configuration created in the previous step
- Save and Process the template in order to create the objects:
	- Namespace: should be the current namespace
	- rest can be left at default/generated
- import `templates/ara/template.yaml` to create the entire object stack for ARA
- Save and Process the template in order to create the objects:
	- Namespace: should be the current namespace
	- Application Hostname can be left blank so the Route will be generated by the cluster
	- all repository settings need to point to a configuration that has the structure of the current one; so if you 
	clone/fork this and/or make the repo private, you need to supply your details
	- **important**: change name of app jar to the synchronized with the source version being built
	- **important**: maven needs to be >=3.1.0 so a version needs to be downloaded as the yum repo only has 3.0.x
		- the download sha URL isn't required

### 2. using `oc` client
```bash
OPENSHIFT_NAMESPACE="your_namespace_name"

# 1. deploy the custom mysql

# 1.1 create the mysql configuration for ARA
oc create -f templates/mysql/mysql-ConfMap.yaml -n $OPENSHIFT_NAMESPACE

# 1.2 check and modify accordingly the parameters from templates/mysql/mysql-ephemeral.param

# 1.3 create all objects from mysql template using the parameter file
oc process -f templates/mysql/mysql-ephemeral.yaml --param-file=templates/mysql/mysql-ephemeral.param | oc create -n $OPENSHIFT_NAMESPACE -f -

# 2. create the objects to build and deploy ARA 

# 2.1 check and modify accordingly the parameters from templates/ara/template.param

# 2.2 create all objects from template using parameter file above
oc process -f templates/ara/template.yaml --param-file=templates/ara/template.param

```